<%= link_to 'Zurück', :back, style:'float:right;color:red'%>
<%  @sprint.sprint_boards.each do |board| %>
    <div class="col-sm-2" style="margin-top: 2em">
      <div class="panel panel-default">
        <div class="panel-heading"><%= board.title %></div>

        <div class="panel-body" id="droppable<%= board.id %>" data-board-id="<%=board.id%>" style="min-height: 8em">

          <% board.sprint_cards.each do |f| %>
              <div class="well well" style="background-color: <%= f.color %>" id="draggable<%= f.id %>" data-card-id="<%=f.id%>"
                   data-toggle="modal" data-target="#sprintCardModal<%= f.id %>">
                <%= f.title %>
              </div>

              <div class="modal fade" id="sprintCardModal<%= f.id %>" role="dialog">
                <div class="modal-dialog">

                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal">&times;</button>
                      <h4 class="modal-title">Karte anpassen</h4>
                    </div>
                    <div class="modal-body">

                      <form id="change-form-sprint-<%= f.id %>" data-card-id="<%= f.id %>">
                        <div class="form-group">
                          <label for="title<%= f.id %>">Beschreibung:</label>
                          <input type="text" class="form-control" id="title<%= f.id %>" placeholder="Neuer Titel">
                        </div>
                        <label for="color">Farbe wählen:</label>
                        <label class="radio-inline">
                          <% if f.color == "lightblue" %>
                              <input type="radio" name="color" checked="checked" value="lightblue"><%= image_tag('lightblue.PNG') %>
                          <% else %>
                              <input type="radio" name="color" value="lightblue"><%= image_tag('lightblue.PNG') %>
                          <% end %>
                        </label>
                        <label class="radio-inline">
                          <% if f.color == "lightcoral" %>
                              <input type="radio" name="color" checked="checked" value="lightcoral"><%= image_tag('lightcoral.PNG') %>
                          <% else %>
                              <input type="radio" name="color" value="lightcoral"><%= image_tag('lightcoral.PNG') %>
                          <% end %>
                        </label>
                        <label class="radio-inline">
                          <% if f.color == "lightsalmon" %>
                              <input type="radio" name="color" checked="checked" value="lightsalmon"><%= image_tag('lightsalmon.PNG') %>
                          <% else %>
                              <input type="radio" name="color" value="lightsalmon"><%= image_tag('lightsalmon.PNG') %>
                          <% end %>
                        </label>
                        <p>
                          <button type="submit" class="btn btn-default">Fertig</button>
                        </p>

                      </form>
                    </div>
                  </div>

                </div>
              </div>

          <% end %>
        </div>
      </div>
    </div>
<% end %>

<script>

  $("[id^=change-form-sprint]").submit( function (e) {
    e.preventDefault();
    var form = $(this);
    var cardId = form.attr("data-card-id");
    var color = form.find('input[type=radio]:checked').val();
    var title = form.find("input[id^=title]").val();
    $('#sprintCardModal'+cardId).modal('hide');
    $.ajax({
      type: "POST",
      url: '/update_sprint_card/'+cardId,
      data: { title: title, color: color },
      success: function(data, textStatus, xhr) {
        var well = $('#draggable'+cardId);
        well.css("background-color", color);
        well.text(title);
      }
    });

  });

  $(document).ready( function() {
    $( "[id^=draggable]" ).draggable({ revert: "invalid", helper: "clone", zIndex: 100 });

    $( "[id^=droppable]" ).droppable({
      classes: {
        "ui-droppable-active": "ui-state-active",
        "ui-droppable-hover": "ui-state-hover"
      },
      drop: function( event, ui ) {
        var cardId = ui.draggable.attr("data-card-id");
        var boardId = $(this).attr("data-board-id");
        $.ajax({
          url: '/change_sprint_board/'+cardId+'/'+boardId,
          success: function(data, textStatus, xhr) {

          }
        });
        $(this).append(ui.draggable);
      }
    });
  } );
</script>